import VideosShortcut from "./VideosShortcut"
import createClerkSupabaseClient from "../config/supabaseClient"
import { useEffect, useState } from "react"
import { useUser } from "@clerk/clerk-react"

const UserStats = () => {
  const [totalHours, setTotalHours] = useState()
  const [focusRate, setFocusRate] = useState()
  const [totalVideos, setTotalVideos] = useState()

  const { user, isLoaded } = useUser()

  const supabase = createClerkSupabaseClient()

  useEffect(() => {
    const fetchData = async () => {
        const { data, error } = await supabase
            .from("user_stats")
            .select()
            .eq("user_id", user?.id)
            .single()
        
        if (data) {
            setTotalHours(data.total_hours)
            setFocusRate(data.focus_rate)
            setTotalVideos(data.total_videos)
        }

        if (error) {
            console.log(error)
        }
    }

    if (user && isLoaded) {
        fetchData()
    }
  }, [isLoaded])

  return (
    <div className="flex-col flex stats shadow bg-base-100 font-[DM_Sans]">
        {isLoaded && <div className="stats shadow bg-base-100 h-57">
            <div className="stat">
                <div className="stat-figure text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M23.957 3.233a3.17 3.17 0 0 0-1.941-2.15a3.9 3.9 0 0 0-2.81-.12a3 3 0 0 0-1 .68a4.8 4.8 0 0 0-1.001 1.43a3.3 3.3 0 0 0-.3.84a.34.34 0 0 0 .22.41a.3.3 0 0 0 .39-.18l.31-.73a4.5 4.5 0 0 1 .75-1a2.26 2.26 0 0 1 .95-.53a3 3 0 0 1 2 .26a2.2 2.2 0 0 1 1.411 1.32c.15.514.178 1.055.08 1.58a6 6 0 0 1-.52 1.531l-.13-.07c-1.06-.54-3.58-1.81-4.35-2.24a.35.35 0 0 0-.471.14a.35.35 0 0 0 .14.47l4.441 2.42c-.09.2-.24.5-.43.87c-1.22 2.421-4.141 7.863-5.181 9.673a11 11 0 0 0-1.36-1.15c-.24-.16-.5-.32-.75-.46a6.5 6.5 0 0 0-.811-.36a8.7 8.7 0 0 0-1.58-.42q.045-.186.12-.36c.92-2.131 3.32-6.832 4.42-9.003c.25-.48.43-.83.51-1c.2-.38-.41-.48-.42-.47a8 8 0 0 0-.66 1.16c-1.21 2.19-3.81 6.792-4.8 8.892c-.23.4-.38.842-.44 1.3c.07.42.51 3.391.8 4.582c.052.318.202.611.43.84c.182.104.39.153.6.14a4.3 4.3 0 0 0 1.33-.39a12.8 12.8 0 0 0 3.07-2c.25-.28 3.262-6.072 4.912-9.473c.49-1 .86-1.79 1-2.17a18 18 0 0 0 .93-2.331a4.7 4.7 0 0 0 .14-1.93M12.824 20.348h-.15s-.68-3.301-.84-4.191c.47.23 1 .54 1.51.84c.31.18.64.34 1 .51s.67.31 1 .48l.78.47c-.566.469-1.18.878-1.83 1.22a7.6 7.6 0 0 1-1.47.67m-.81 2.171a16 16 0 0 1-1.81-.5a5.7 5.7 0 0 1-1.071-.49a1.25 1.25 0 0 1-.58-.74a3.2 3.2 0 0 1 .19-1.3a3 3 0 0 0 0-1.891a1.83 1.83 0 0 0-.79-.82a3.4 3.4 0 0 0-1.37-.42a12.6 12.6 0 0 0-2.571.22c-1.26.256-2.503.59-3.721 1a.311.311 0 0 0-.03.618q.06.007.12-.008c1-.21 2-.42 3.09-.56a12.8 12.8 0 0 1 3.001-.08c.248.027.488.098.71.21c.18.09.37.18.43.33a2 2 0 0 1 0 1.2a3.8 3.8 0 0 0-.08 1.79a2.1 2.1 0 0 0 1.09 1.281q.63.316 1.311.49q.96.252 1.94.39a.35.35 0 0 0 .4-.28a.35.35 0 0 0-.26-.44" clip-rule="evenodd"/></svg>
                </div>
                <div className="stat-title">Total Hours of Studying</div>
                <div className="stat-value text-neutral-700">{totalHours}</div>
                <div className="stat-desc">X% more than last month</div>
            </div>
            <div className="stat">
                <div className="stat-figure text-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M23.986 11.795a16 16 0 0 0-.3-2.798a1.73 1.73 0 0 0-.45-.919a2 2 0 0 0-.769-.36a14 14 0 0 0-1.548-.23a1.33 1.33 0 0 1-.68-.21c-.11-.099-.11-.349-.14-.618a6.7 6.7 0 0 0-.28-1.52c-.096-.266-.27-.5-.499-.668a2.6 2.6 0 0 0-1.059-.41a15 15 0 0 0-2.328 0a.34.34 0 0 0-.34.33a.35.35 0 0 0 .34.35a19 19 0 0 1 1.899.06c.358.032.702.156.999.359c.18.13.22.41.27.7q.045.84.2 1.668c.047.17.132.327.249.46c.217.2.482.341.77.409c2.137.63 2.097 0 2.287.999c.161 1.038.234 2.087.22 3.137a12 12 0 0 1-.11 1.798c-.01.177-.055.35-.13.51c-.22.191-.498.3-.79.31a7.3 7.3 0 0 0-1.308.28a2.1 2.1 0 0 0-.7.369a1.3 1.3 0 0 0-.459.86c-.08.459 0 1.068-.07 1.578c0 .25-.07.48-.26.59c-.366.208-.77.343-1.188.399q-.996.114-1.999.1a.3.3 0 0 0 0 .6q1.066.06 2.128 0a4 4 0 0 0 1.46-.41c.285-.146.504-.396.609-.7a6.6 6.6 0 0 0 .22-1.648c0-.26 0-.49.18-.6a2.2 2.2 0 0 1 .998-.3q.652-.083 1.28-.28a1.67 1.67 0 0 0 .768-.509c.182-.26.305-.556.36-.869c.156-.93.213-1.875.17-2.817M6.502 19.368q-2.002.045-3.996-.15a1.84 1.84 0 0 1-1.199-.51s0-.15-.05-.27c-.06-.419-.09-1.068-.11-1.778v-6.634q0-1.059-.06-2.158a7 7 0 0 1 0-1.508a1.35 1.35 0 0 1 .29-.73a2 2 0 0 1 .9-.559c.6-.15 1.218-.217 1.837-.2l2.718-.08a.29.29 0 0 0 .3-.29a.29.29 0 0 0-.29-.3l-2.708-.07a7.3 7.3 0 0 0-2.078.12c-.51.12-.977.38-1.348.75c-.301.331-.505.74-.59 1.179a8 8 0 0 0-.11 1.718v5.355c0 .64.06 2.578.18 3.997c.011.659.136 1.311.37 1.928a2.6 2.6 0 0 0 1.858.84c1.36.079 2.725.079 4.086 0a.34.34 0 0 0 .34-.34a.34.34 0 0 0-.34-.31"/><path d="M18.501 10.326a1.61 1.61 0 0 0-1.199-.76a29 29 0 0 0-3.257-.439h-.49a4 4 0 0 1 0-.42c0-1.458.15-4.835.08-6.344a2.7 2.7 0 0 0-.12-.829c-.06-.13-.23-.39-.619-.12a5.5 5.5 0 0 0-.69.65C10.939 3.343 8.42 6.4 6.493 8.808a120 120 0 0 0-2.328 2.997q-.135.185-.24.39a.47.47 0 0 0 0 .519a.63.63 0 0 0 .3.22q.54.152 1.1.19c1.228.12 3.206.14 3.916.17v.359c0 1.728-.21 5.705-.3 7.523v.84a.67.67 0 0 0 .36.649a.6.6 0 0 0 .639-.14q.27-.255.51-.54a97 97 0 0 0 4.056-5.175a57 57 0 0 0 3.736-5.465c.197-.302.289-.66.26-1.019m-1.399 1.06c-1.408 2.227-5.115 6.993-6.993 9.19c0-1.098.12-2.607.17-3.996s.07-2.767 0-3.387q.021-.225 0-.45a.54.54 0 0 0-.33-.399a2.4 2.4 0 0 0-.68-.07c-.998 0-3.097 0-4.196-.14l.4-.569c1.589-2.208 5.245-6.994 6.994-8.902c.17-.19.32-.41.45-.58a.5.5 0 0 1 0 .12c.05 1.19-.14 3.887-.19 5.615q-.056.744 0 1.489a.6.6 0 0 0 .22.41c.204.11.428.177.659.2c.849.14 2.547.28 3.536.559q.184.07.34.19c-.07.18-.22.46-.38.72"/></g></svg>
                </div>
                <div className="stat-title">Focus Rate</div>
                <div className="stat-value text-neutral-700">{focusRate}%</div>
                <div className="stat-desc">X% more than last month</div>
            </div>
            <div className="stat">
                <div className="stat-figure text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"><path fill="currentColor" d="M23.623 12.876c-.869-2.547-3.496-.47-5.613 1.059c0-1.838.22-3.107-2.907-3.456c2.717-1.598 1.479-5.244-.998-5.733c-2.188-.37-4.295 1.148-3.906 3.456a2.85 2.85 0 0 0 1.588 2.097c-1.677 0-3.336.07-4.993.2A4.7 4.7 0 0 0 8.94 9.16c1.998-2.656 0-6.631-2.996-7.22a5.55 5.55 0 0 0-4.325.998a4.355 4.355 0 0 0 1.218 7.47a.31.31 0 0 0 .39-.149c-.17.61 1.138.46.47.53a.35.35 0 0 0-.31.369c.07.67.799 0 6.362 0a31 31 0 0 1 6.113.45c.669.19.998.389 1.058.998v4.135c0 1.079 0 2.797-.62 3.646c-.468.609-2.336.46-3.135.5c-2.842.31-5.711.26-8.54-.15c-2.607-.58-2.607-.31-2.757-2.747c-.07-1-.629-5.484.33-6.233q.453-.195.929-.32a.31.31 0 0 0-.2-.559a1.74 1.74 0 0 0-1.638 1.119a11.7 11.7 0 0 0-.39 3.096c0 .32.17 3.995.23 4.365a2 2 0 0 0 1.279 1.678a21 21 0 0 0 5.543.999c1.758.07 3.516-.06 5.264-.14c2.487-.12 4.394.32 4.754-3.206c1.139.739 3.426 1.997 4.774 1.897c1.089-.1.999-1.388 1.049-2.187a14 14 0 0 0-.17-5.623M3.268 10.219c.14-.51-.75-.29-1.688-1.528a3.496 3.496 0 0 1 .709-4.894a3.995 3.995 0 0 1 6.053 1.458a3.4 3.4 0 0 1-.15 3.376A5.14 5.14 0 0 1 3.677 10a.34.34 0 0 0-.41.22m7.74-2.117a2.267 2.267 0 1 1 4.305.999c-.339.5-.852.855-1.438.998q-.275.032-.55 0a2.297 2.297 0 0 1-2.317-1.997m11.556 11.586a6 6 0 0 1-2.916-.82c-1.209-.599-1.328-.828-1.628-.728v-3.446a13.7 13.7 0 0 1 3.815-1.998a.61.61 0 0 1 .75.52c.539 1.847.04 6.112-.02 6.472"/><path fill="currentColor" d="M3.857 13.845c-.13 5.503.06 5.423 4.594 5.054c.87-.09 2.308.1 2.997-.87a3.4 3.4 0 0 0 .31-2.396c-.18-1.449-.26-2.647-1.828-2.927c-1.888-.33-3.416.5-5.184.54a.34.34 0 0 0-.33.429a.3.3 0 0 0-.559.17m5.873-.2c.949.22.829 1.079.909 2.097c.19 2.248-.25 1.798-2.307 1.998c-.62.08-2.997.55-3.416.07s-.44-3.995-.47-4.075c.39.66 3.366-.54 5.284-.09m5.743.919a3.8 3.8 0 0 0-1.798-.09c-.67.19-.999.15-1.169.47c-.06.11 0 .23.19.359q.165.064.34.09l.69.16a4.4 4.4 0 0 0 1.747-.31a.34.34 0 0 0 0-.68m-.01 1.919a4.3 4.3 0 0 0-.929-.26a4.5 4.5 0 0 0-1.678.35a.27.27 0 0 0 0 .479q.552.17 1.119.28q.294.021.589 0c.31 0 .57-.15.869-.19a.34.34 0 1 0 .03-.66"/></svg>
                </div>
                <div className="stat-title">Total Study Videos</div>
                <div className="stat-value text-neutral-700">{totalVideos}</div>
                <div className="stat-desc">X% more than last month</div>
            </div>
        </div>}
        <div className="flex h-full">
            <VideosShortcut />
        </div>
    </div>
  )
}

export default UserStats